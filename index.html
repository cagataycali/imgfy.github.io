<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>imgify.xyz</title>
    <meta name="author" content="Çağatay Çalı">
    <script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha256-cCueBR6CsyA4/9szpPfrX3s49M9vUU5BgtiJj06wt/s="   crossorigin="anonymous"></script>
  </head>
  <body id="body">
    <script src="dom-to-image.min.js" />
    <script type="text/javascript">
      var content;
      try {
        decodeURIComponent(window.location.href).match(/content=([^&]+)/)[1];
        content = JSON.parse(decodeURIComponent(window.location.href).match(/content=([^&]+)/)[1]);
      } catch (e) {
        alert('Check your content json.')
      } finally {

      }

      function createImg(image) {
        $('body').append(`<img src="${image.src}" id="${image.id}">`);
        $(`#${image.id}`).css(image.property)
      }
      $('body').css( content.template );

      content.images.forEach(function (image) {
        createImg(image);
      })

      var node = document.getElementById('body');

      domtoimage.toJpeg(node, { quality: 0.95 })
        .then(function (dataUrl) {
            var link = document.createElement('a');
            link.download = 'my-image-name.jpeg';
            link.href = dataUrl;
            link.click();
        });
    </script>
  </body>
</html>
